Spectrum Open Source — Sequência de Implementação (Fases 1–4)
Objetivo: backend + portal web para planejamento/viabilidade de RF (FM/TV) com dados locais (IBGE/Anatel) e PostGIS. Dev em WSL/PostgreSQL; SQLite só cobre autenticação simples, não GIS.

1) Ambiente e config
- Copiar `.env.example` -> `.env` e preencher DATABASE_URL/SECRET_KEY/SMTP/Redis.
- Ativar `venv` e `pip install -r requirements.txt`.
- Garantir `CREATE EXTENSION postgis;`.
- Inicializar esquema: `flask shell -c "from app.config import init_db; init_db()"` (ou `flask db migrate/upgrade` se usar Alembic).

2) Autenticação e CLI
- Blueprints `auth` (HTML) e `auth_api` (JSON), `web` (páginas), `projects` e `core`.
- Argon2 + política de senha (>=8, letra e dígito); verificação por e-mail (`app/utils/email.py` usa .env; mocka se vazio).
- CLI `flask user.create/list/set-password/promote` para bootstrap do admin.

3) Dados/ETL (Knowledge_base)
- Ingestão setores: `python -m scripts.ingest_kb shp Knowledge_base/Ibge/BR_setores_CD2022.shp --layer ibge_setores_cd2022`.
- Merge demografia: gerar CSV do Excel (`Knowledge_base/Ibge/populacao.csv`) e `python -m scripts.ingest_kb csv ...`.
- Agregar municípios: `python -m scripts.ingest_kb municipios --source ibge_setores_cd2022 --target ibge_municipios_2022`.
- Tiles: `/api/tiles/<layer>/<z>/<x>/<y>?limit=500&cd_mun=3304557` (camada deve existir em `vector_layers`).

4) Modelos e API
- ORM (`app/models.py`): User/Project/Station/Simulation/VectorLayer/VectorFeature/ProjectArtifact; geometria SRID 4326.
- API core (`app/api/routes_core.py`): health, criar estação, iniciar simulação, status, analytics, tiles, download de artefatos.
- Projetos (`/api/projects`): lista e cria projetos do usuário logado.
- Tasks Celery (`app/tasks.py`): `run_coverage_simulation` chama `app/core/propagation.py`.

5) Frontend (base_portal)
- Layout principal `base_portal.html`; dashboards/cards (`home.html`), projetos (`projects.html` com formulário + listagem dinâmica), páginas stub (`map.html`, `database.html`, etc.).
- Estilos e interações em `app/static/css/dashboard.css` e `app/static/js/dashboard.js` (fetch user, summary, projects).
- Auth UI responsiva em `app/templates/auth/login.html` e `register.html`.

6) Execução diária
- `flask run` para API/páginas; `celery -A app.tasks.celery_app worker -l info` para jobs.
- Carregar KB antes de usar tiles/analytics.
- Criar usuário inicial via CLI; confirmar e-mail usando link gerado (ou SMTP real conforme .env).

7) Testes e validação
- `pytest` (usa `TEST_DATABASE_URL` ou `DATABASE_URL` PostGIS); fixtures resetam schema.
- Verificar `/api/health`, `/api/analytics/summary`, tiles e fluxo de login/registro.

8) Deploy VPS
- Mesmo .env (.prod), PostGIS/Redis instalados, `SRTM/` e `Knowledge_base/` montados fora do repo.
- Usar gunicorn/NGINX para Flask; supervisão para Celery worker e logs (etl_errors.log).
